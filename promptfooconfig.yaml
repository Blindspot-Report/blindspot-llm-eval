description: "Blindspot LLM Political Analysis Evaluation"

# Shared config anchor for all providers
x-chunk-config: &chunk-config
  temperature: 0.2
  num_predict: 8192
  top_p: 0.9
  top_k: 40
  passthrough:
    format:
      type: object
      properties:
        keyPoints:
          type: array
          items:
            type: string
        quotes:
          type: array
          items:
            type: object
            properties:
              startIndex:
                type: integer
              endIndex:
                type: integer
              context:
                type: string
              significance:
                type: string
                enum: ["high", "medium", "low"]
            required: ["startIndex", "endIndex", "context", "significance"]
        stanceSignals:
          type: array
          items:
            type: object
            properties:
              topic:
                type: string
              position:
                type: string
              strength:
                type: string
                enum: ["strong", "moderate", "weak"]
            required: ["topic", "position", "strength"]
        topics:
          type: array
          items:
            type: string
        tone:
          type: string
      required: ["keyPoints", "quotes", "stanceSignals", "topics", "tone"]

# Shared structural assertions (used as anchor reference)
x-chunk-assertions: &chunk-assertions
  - type: is-json
  - type: javascript
    value: file://assertions/chunk-analysis.js
  - type: llm-rubric
    value: file://assertions/semantic-accuracy-rubric.txt

providers:
  - id: ollama:chat:gemma3:12b
    label: "Gemma3 12B (baseline)"
    config: *chunk-config

  - id: ollama:chat:phi4-mini
    label: "Phi-4 Mini 3.8B"
    config: *chunk-config

  - id: ollama:chat:llama3.2:3b
    label: "Llama 3.2 3B"
    config: *chunk-config

  - id: ollama:chat:granite3.3:8b
    label: "Granite 3.3 8B"
    config: *chunk-config

prompts:
  - file://prompts/chunk-analysis.json

tests:
  - description: "Megyn Kelly AM Update 2/6 — Clinton depositions, voter ID, Guthrie kidnapping"
    vars:
      transcript: file://test-cases/transcripts/megyn-kelly-10433.txt
    assert:
      - type: is-json
      - type: javascript
        value: file://assertions/chunk-analysis.js
      - type: llm-rubric
        value: file://assertions/semantic-accuracy-rubric.txt
      - type: factuality
        value: |
          Congressman Comer prefers depositions over public hearings because depositions are more substantive.
          Hillary Clinton challenged Comer to hold public hearings rather than depositions.
          Bill and Hillary Clinton initially resisted appearing for depositions before Congress.
          The Guthrie family is seeking information about their missing 84-year-old mother Nancy Guthrie.
          Derek Kalella was arrested for sending fake ransom texts to the Guthrie family.

  - description: "Megyn Kelly — Guthrie investigation, Kelsey Grammer, GOP in Hollywood"
    vars:
      transcript: file://test-cases/transcripts/megyn-kelly-10434.txt
    assert:
      - type: is-json
      - type: javascript
        value: file://assertions/chunk-analysis.js
      - type: llm-rubric
        value: file://assertions/semantic-accuracy-rubric.txt
      - type: factuality
        value: |
          Savannah Guthrie and her siblings released a video pleading for their mother's return.
          Reports of a ransom letter have surfaced and the family acknowledges them.
          The video's production style was intentionally unpolished.
          Law enforcement assisted in the video's production.

  - description: "Megyn Kelly AM Update 2/5 — ICE drawdown, gender-affirming care reversal"
    vars:
      transcript: file://test-cases/transcripts/megyn-kelly-10435.txt
    assert:
      - type: is-json
      - type: javascript
        value: file://assertions/chunk-analysis.js
      - type: llm-rubric
        value: file://assertions/semantic-accuracy-rubric.txt
      - type: factuality
        value: |
          Tom Homan announced a drawdown of 700 federal agents in Minneapolis due to increased local law enforcement cooperation.
          Tommaso Sioni, Annie Guthrie's husband, is being investigated as a possible suspect in Nancy Guthrie's disappearance.
          Two medical organizations have taken a position against performing permanent surgeries on gender-confused children.
          The search for Nancy Guthrie is ongoing with a ransom note received.

defaultTest:
  options:
    timeout: 900000  # 15 min to match Blindspot's timeout
    provider: anthropic:messages:claude-haiku-4-5-20251001  # grading model for LLM-based assertions
